var nph = require("./index.js"),
    express = require('express'),
    data = [0.61, 0.64, 0.68, 0.71, 0.71, 0.71, 0.74, 0.81, 0.88, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.9, 0.79, 0.68, 0.57, 0.46, 0.35, 0.24, 0.13, 0.02, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.01, 0.12, 0.23, 0.34, 0.45, 0.56, 0.67, 0.78, 0.88, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.91, 0.9, 0.83, 0.76, 0.67, 0.56, 0.45, 0.35, 0.26, 0.17, 0.15, 0.15];

var app = express();

/**
 * Run the server on the right port (look for the AWS env variable)
 */
app.set('port', 3000);

/**
 * Handle a heatmaps meta-data request
 */
app.get('/image', function(req, res) {

    new nph({
        data: data,
        mirror: true,
        width: 1800,
        height: 150,
        color: {
            r: 0,
            g: 0,
            b: 0,
            a: 100
        },
        pattern: true
    }).generatePNG(function(alldata) {
        res.setHeader("Content-Type", "image/png");
        res.end(alldata);
    });

});

/**
 * Start up the server
 */
app.listen(app.get('port'));
